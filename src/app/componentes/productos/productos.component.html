
<div class="button-container">
  <button pButton type="button" label="Agregar Producto" icon="pi pi-plus" class=" p-button-primary floating-button" severity="contrast"
  (click)="openAddProductDialog()"></button>
</div>

<div class="products-container">
  <div class="products-grid">
    <div *ngFor="let producto of productoss" class="product-card" (click)="showDialog(producto.producto_id)">
      <!--img [src]="producto.imagen_prod || 'images/defect.png'" alt="{{ producto.nombre_prod }}" class="product-image"/-->
      <img src="images/defect.png"  alt="{{ producto.nombre_prod }}" class="product-image" >
      <div class="product-details">
        <div class="product-info">
          <span class="product-name">{{ producto.nombre_prod }}</span>
          <span class="product-brand">{{ producto.marca_prod }}</span>
        </div>
        <p class="product-presentacion"> {{ producto.presentacion_prod }}</p>

      <div class="product-datos">
      <p class="product-categoria">Categoría: {{ producto.categoria.nombre_cat }}</p>
      <p class="product-proveedor">Proveedor: {{ producto.proveedor.nombre_prov }}</p>
      <p class="product-id">{{ producto.producto_id }}</p>
      <span class="product-disponibilidad"><strong>{{ producto.disponibilidad_prod ? 'DISPONIBLE' : 'AGOTADO' }}</strong></span>
</div>

      </div>
    </div>
  </div>
</div>


  <p-dialog
  header="Detalle del Producto"
  [modal]="true"
  [(visible)]="visible"
  [style]="{ width: '60%' }">

    <div *ngIf="selectedDetalles.length > 0; else noDetalles">
      <p-table
      [value]="selectedDetalles"
      [tableStyle]="{ 'min-width': '60%' }">
      <ng-template #header>
        <tr>
          <th>ID</th>
          <th>Fecha de ingreso</th>
          <th>Fecha de vencimiento</th>
          <th>Peso</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      <ng-template #body let-detalle>
        <tr>
          <td>{{ detalle.detalle_producto_id }}</td>
          <td>{{ detalle.fecha_ingreso_prod }}</td>
          <td>{{ detalle.fecha_vencimiento_prod }}</td>
          <td>{{ detalle.peso_prod }}</td>
          <td>{{ detalle.precio_prod }}</td>
          <td>{{ detalle.stock }}</td>
          <td>
            <div class="flex">
              <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true" ></p-button>
              <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" ></p-button>
            </div>

        </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
  <ng-template #noDetalles>
    <p>No hay lotes para este producto.</p>
  </ng-template>

</p-dialog>




<p-dialog [(visible)]="addProductDialogVisible" [style]="{ width: '60%' }" header="Agregar Producto" [modal]="true">
  <ng-template pTemplate="content">
    <div class="grid flex-col gap-2">
      <div class="flex col-12">
        <div class="col-4">
          <label for="productId" class="block font-bold mb-3">ID del Producto</label>
          <input type="text" pInputText id="productId" [(ngModel)]="newProduct.producto_id" name="producto_id" required autofocus fluid>
          <small class="text-red-500" *ngIf="submitted && !newProduct.producto_id">El ID del producto es obligatorio.</small>
        </div>

        <div class="col-8">
          <label for="nombreProd" class="block font-bold mb-3">Nombre</label>
          <input type="text" pInputText id="nombreProd" [(ngModel)]="newProduct.nombre_prod" name="nombre_prod" required autofocus fluid>
          <small class="text-red-500" *ngIf="submitted && !newProduct.nombre_prod">El nombre del producto es obligatorio.</small>
        </div>
      </div>

      <div class="flex col-12">
        <div class="col-6">
          <label for="marcaProd" class="block font-bold mb-3">Marca</label>
          <input type="text" pInputText id="marcaProd" [(ngModel)]="newProduct.marca_prod" name="marca_prod" required fluid>
          <small class="text-red-500" *ngIf="submitted && !newProduct.marca_prod">La marca del producto es obligatoria.</small>
        </div>
        <div class="col-6">
          <label for="presentacionProd" class="block font-bold mb-3">Presentación</label>
          <input type="text" pInputText id="presentacionProd" [(ngModel)]="newProduct.presentacion_prod" name="presentacion_prod" required fluid>
          <small class="text-red-500" *ngIf="submitted && !newProduct.presentacion_prod">La presentación del producto es obligatoria.</small>
        </div>
      </div>

      <div class="flex col-12">
        <div class="col-6">
          <label for="disponibilidadProd" class="block font-bold mb-3">Disponibilidad</label>
          <div class="grid grid-cols-12 gap-4">
            <div class="flex items-center gap-2 col-span-6">
              <p-radiobutton id="DISPONIBLE" name="disponibilidad" value="true" [(ngModel)]="newProduct.disponibilidad_prod"></p-radiobutton>
              <label for="DISPONIBLE">DISPONIBLE</label>
            </div>
            <div class="flex items-center gap-2 col-span-6">
              <p-radiobutton id="AGOTADO" name="disponibilidad" value="false" [(ngModel)]="newProduct.disponibilidad_prod"></p-radiobutton>
              <label for="AGOTADO">AGOTADO</label>
            </div>
            <small class="text-red-500" *ngIf="submitted && newProduct.disponibilidad_prod === null">La disponibilidad es obligatoria.</small>
          </div>
        </div>
        <div class="col-6">
          <label for="imagenProd" class="block font-bold mb-3">Imagen</label>
          <input type="text" pInputText id="imagenProd" [(ngModel)]="newProduct.imagen_prod" name="imagen_prod" fluid>
        </div>
      </div>

      <div class="flex col-12">
        <div class="col-6">
          <label for="categoriaId" class="block font-bold mb-3">Categoría</label>
          <p-select [options]="categorias" [(ngModel)]="newProduct.categoria.categoria_id" optionLabel="nombre_cat" appendTo="body" optionValue="categoria_id" placeholder="Seleccione una categoría" name="categoriaId" required></p-select>
          <small class="text-red-500" *ngIf="submitted && !newProduct.categoria.categoria_id">La categoría es obligatoria.</small>
        </div>
        <div class="col-6">
          <label for="proveedorId" class="block font-bold mb-3">Proveedor</label>
          <p-select [options]="proveedores" [(ngModel)]="newProduct.proveedor.proveedor_id" optionLabel="nombre_prov" appendTo="body" optionValue="proveedor_id" placeholder="Seleccione un proveedor" name="proveedorId" required></p-select>
          <small class="text-red-500" *ngIf="submitted && !newProduct.proveedor.proveedor_id">El proveedor es obligatorio.</small>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <p-button label="Cancelar" icon="pi pi-times" (click)="hideDialog()"></p-button>
    <p-button label="Guardar" icon="pi pi-check" (click)="saveProduct()"></p-button>
  </ng-template>
</p-dialog>



